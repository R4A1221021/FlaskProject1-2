{% extends "layout.html" %}

{% block title %}設定・プライバシー{% endblock %}

{% block content %}
<div class="flex flex-col items-center justify-center h-full">
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">設定・プライバシー</h2>
            <a href="{{ url_for('menu') }}" class="text-sm text-blue-500 hover:underline">&lt; メニューに戻る</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="px-4 py-3 rounded relative mb-4 w-full
                    {% if category == 'danger' %} bg-red-100 border border-red-400 text-red-700
                    {% elif category == 'success' %} bg-green-100 border border-green-400 text-green-700
                    {% else %} bg-blue-100 border border-blue-400 text-blue-700 {% endif %}"
                     role="alert">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-2">ラズベリーパイ通信設定</h3>
            <p class="text-gray-600 mb-4">ラズベリーパイデバイスとのデータ同期設定を行います。</p>
            <button class="w-full bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition-colors opacity-50 cursor-not-allowed" disabled>
                RPiデバイス認証 (未実装)
            </button>
        </div>

        <div class="border-t pt-6">
            <h3 class="text-lg font-semibold mb-4">アカウント設定</h3>

            <form method="POST" action="{{ url_for('settings') }}" class="mb-6">
                {{ username_form.hidden_tag() }}
                <div class="mb-4">
                    {{ username_form.username.label(class="block text-gray-700 font-medium mb-1") }}
                    {{ username_form.username(class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", placeholder="新しいユーザー名") }}
                </div>
                {{ username_form.submit_username(class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-all font-semibold shadow-md cursor-pointer mt-4") }}
            </form>

            <hr class="my-6">

            <form method="POST" action="{{ url_for('settings') }}" class="mb-6">
                {{ password_form.hidden_tag() }}
                <div class="mb-4">
                    {{ password_form.old_password.label(class="block text-gray-700 font-medium mb-1") }}
                    {{ password_form.old_password(class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500", placeholder="現在のパスワード") }}
                </div>
                <div class="mb-4">
                    {{ password_form.new_password.label(class="block text-gray-700 font-medium mb-1") }}
                    {{ password_form.new_password(class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500", placeholder="新しいパスワード") }}
                </div>
                <div class="mb-4">
                    {{ password_form.new_password2.label(class="block text-gray-700 font-medium mb-1") }}
                    {{ password_form.new_password2(class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500", placeholder="新しいパスワード (確認)") }}
                </div>
                {{ password_form.submit_password(class="w-full bg-red-600 text-white p-3 rounded-lg hover:bg-red-700 transition-all font-semibold shadow-md cursor-pointer mt-4") }}
            </form>

            <hr class="my-6">

            <a href="{{ url_for('logout') }}" class="block w-full text-center bg-gray-500 text-white p-2 rounded-lg hover:bg-gray-600 transition-colors">
                ログアウト
            </a>
        </div>
        </div>
</div>
{% endblock %}